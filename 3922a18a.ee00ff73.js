(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{73:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return l})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(2),i=a(6),r=(a(0),a(108)),c=a(139),b=a.n(c),o={id:"debugger",title:"Starlark Debugger"},l={unversionedId:"vscode/debugger",id:"vscode/debugger",isDocsHomePage:!1,title:"Starlark Debugger",description:"The Starlark Debugger component manages starlark debug sessions.",source:"@site/docs/vscode/debugger.md",slug:"/vscode/debugger",permalink:"/docs/next/vscode/debugger",editUrl:"https://github.com/stackb/bazel-stack-vscode/edit/master/docs/docs/vscode/debugger.md",version:"current",sidebar:"docs",previous:{title:"Buildozer",permalink:"/docs/next/vscode/buildozer"},next:{title:"Starlark Language Server",permalink:"/docs/next/vscode/starlark-language-server"}},s=[{value:"Usage via &quot;Code Action&quot; Link",id:"usage-via-code-action-link",children:[]},{value:"Debug Configurations",id:"debug-configurations",children:[{value:"Launch Configuration",id:"launch-configuration",children:[]},{value:"Attach Configuration",id:"attach-configuration",children:[]}]},{value:"Caveats",id:"caveats",children:[]}],d={rightToc:s};function p(e){var t=e.components,a=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},d,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"The Starlark Debugger component manages starlark debug sessions."),Object(r.b)("p",null,"There are three actors in the system:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"VSCode acts as the ",Object(r.b)("em",{parentName:"li"},"debug client")," that requests thread, stack frame, and variable\ninformation over the ",Object(r.b)("em",{parentName:"li"},"debug adapter protocol")," (DAP). "),Object(r.b)("li",{parentName:"ol"},"Bazel is the ",Object(r.b)("em",{parentName:"li"},"debug server")," that sends thread, stack frame, and variable\ninformation over a protocol buffer based API."),Object(r.b)("li",{parentName:"ol"},"The ",Object(r.b)("inlineCode",{parentName:"li"},"bzl debug adapter")," command acts as in intermediary between the two,\ntranslating between the DAP and protobuf schema.")),Object(r.b)("h2",{id:"usage-via-code-action-link"},'Usage via "Code Action" Link'),Object(r.b)("p",null,"The debugger ",Object(r.b)("em",{parentName:"p"},"should")," work out of the box by clicking on a ",Object(r.b)("inlineCode",{parentName:"p"},"debug")," code action:"),Object(r.b)("p",null,Object(r.b)("img",Object(n.a)({parentName:"p"},{src:"https://user-images.githubusercontent.com/50580/144439494-8e37f41a-2e1d-4d2a-b73e-fda50c13c1fc.png",alt:"image"}))),Object(r.b)("p",null,"When clicked, three things are happening:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"The debug adapter is launched in an integrated terminal, listening on port ",Object(r.b)("inlineCode",{parentName:"p"},":4711"),".  You don't need to watch this, just know that it's there.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"A second integrated terminal is launched that invokes ",Object(r.b)("inlineCode",{parentName:"p"},"bazel build --experimental_skylark_debug"),":"),Object(r.b)("p",{parentName:"li"},Object(r.b)("img",Object(n.a)({parentName:"p"},{src:"https://user-images.githubusercontent.com/50580/144440559-8a112b23-5268-4c90-a3cc-52395627983b.png",alt:"image"}))),Object(r.b)("p",{parentName:"li"},"Keep an eye on this terminal if things aren't working as expected.  Most\nlikely, the process exited because the starlark parsing/execution was\nincrementally cached; in that case the debugger will never hit your\nbreakpoint.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"VSCode starts a ",Object(r.b)("em",{parentName:"p"},"debug session"),", communicating over port ",Object(r.b)("inlineCode",{parentName:"p"},":4711")," with the\ndebug adapter.  In this scenario, a ",Object(r.b)("em",{parentName:"p"},"debug configuration")," was dynamically\ngenerated."))),Object(r.b)("h2",{id:"debug-configurations"},"Debug Configurations"),Object(r.b)("p",null,"Instead of using a dynamically-generated ",Object(r.b)("em",{parentName:"p"},"debug configuration"),', you may want to\ncreate a "static" configuration.  This provides more control over the specifics\nof the debug session.  You have two basic choices:'),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"A ",Object(r.b)("inlineCode",{parentName:"p"},"launch")," configuration.  In this scenario the bazel server and debug\nadapter are automatically run (as described in the code action scenario\nabove).")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"An ",Object(r.b)("inlineCode",{parentName:"p"},"attach")," configuration.  In this scenario, you are responsible for\nstarting up the server and adapter yourself."))),Object(r.b)("h3",{id:"launch-configuration"},"Launch Configuration"),Object(r.b)("p",null,"To create a debug configuration, click on the ",Object(r.b)("em",{parentName:"p"},"debug settings"),' "gear" icon:'),Object(r.b)("p",null,Object(r.b)("img",Object(n.a)({parentName:"p"},{src:"https://user-images.githubusercontent.com/50580/144442486-b0b7499b-f027-4da4-97c7-3e127fb1e94f.png",alt:"image"}))),Object(r.b)("p",null,"Click the ",Object(r.b)("inlineCode",{parentName:"p"},"[Add Configuration]")," button and scroll down to ",Object(r.b)("inlineCode",{parentName:"p"},"Starlark Debug: Launch"),":"),Object(r.b)("p",null,Object(r.b)("img",Object(n.a)({parentName:"p"},{src:"https://user-images.githubusercontent.com/50580/144442534-acc18a5e-d176-46b1-aaab-7f28c0d0f388.png",alt:"image"}))),Object(r.b)("p",null,"Fill in the bazel label that should be used when launching the bazel server process:"),Object(r.b)("p",null,Object(r.b)("img",Object(n.a)({parentName:"p"},{src:"https://user-images.githubusercontent.com/50580/144442735-8a6e5366-7a94-4ccb-a0e1-fdd69bfface4.png",alt:"image"}))),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n    "configurations": [\n        {\n            "type": "starlark",\n            "request": "launch",\n            "name": "Starlark debug //example/routeguide:routeguide_nodejs_library",\n            "targetLabel": "//example/routeguide:routeguide_nodejs_library"\n        }\n    ]\n}\n')),Object(r.b)("p",null,"At this point, you can start a debug sesssion under this configuration by\nmanually choosing in the dropdown (or press ",Object(r.b)("inlineCode",{parentName:"p"},"F5"),"): "),Object(r.b)("p",null,Object(r.b)("img",Object(n.a)({parentName:"p"},{src:"https://user-images.githubusercontent.com/50580/144443989-4e454137-c29b-4e04-87db-fb5b0eed41cb.png",alt:"image"}))),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"When the bazel debug server is launched, the flags used on the command line are taken from the ",Object(r.b)("inlineCode",{parentName:"p"},"bsv.bazel.starlarkDebugFlags")," setting.  You can add ",Object(r.b)("inlineCode",{parentName:"p"},"--experimental_skylark_debug_verbose_logging")," here, if desired."))),Object(r.b)("p",null,Object(r.b)("img",Object(n.a)({parentName:"p"},{src:"https://user-images.githubusercontent.com/50580/144522108-ea529e73-02e3-4dca-a5ea-5fda77f39db4.png",alt:"image"}))),Object(r.b)("h3",{id:"attach-configuration"},"Attach Configuration"),Object(r.b)("p",null,"Using ",Object(r.b)("inlineCode",{parentName:"p"},"attach")," is the preferred method if things aren't working correctly or you\nneed more control over starting the ",Object(r.b)("inlineCode",{parentName:"p"},"bazel")," invocation."),Object(r.b)("p",null,"Follow the same procedure to create an attach configuration, or enter it\nmanually in your ",Object(r.b)("inlineCode",{parentName:"p"},".vscode/launch.json")," file:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n    "configurations": [\n        {\n            "type": "starlark",\n            "request": "attach",\n            "name": "Attach to a running Starlark Debug Adapter",\n            "debugServer": 4711\n        }\n    ]\n}\n')),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},Object(r.b)("inlineCode",{parentName:"p"},'"debugServer": 4711')," is the default and does not need to be explicitly provided."))),Object(r.b)("p",null,"Perform the following steps:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Launch the ",Object(r.b)("inlineCode",{parentName:"p"},"bzl debug adapter")," somewhere.  You can use the ",Object(r.b)("inlineCode",{parentName:"p"},"Launch")," tree item\nin the component UI, or run the executable directly."),Object(r.b)("div",Object(n.a)({parentName:"li"},{className:"admonition admonition-caution alert alert--warning"}),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"When the debug adapter starts up, it runs a bazel query to prepare several\nfiles.  If you already have a bazel invocation running, this can block.  If\nthis is an issue, run the adapter with\n",Object(r.b)("inlineCode",{parentName:"p"},"--make_default_workspace_content=false"),".")))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Start your bazel command using the ",Object(r.b)("inlineCode",{parentName:"p"},"--experimental_skylark_debug")," flag. The\nserver will block waiting for a client connection."),Object(r.b)("p",{parentName:"li"}," :::tip\nUse the ",Object(r.b)("inlineCode",{parentName:"p"},"--experimental_skylark_debug_verbose_logging")," flag to get extra info from the server.\n:::")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Start a debug session with ",Object(r.b)("inlineCode",{parentName:"p"},"F5")," using the attach configuration."))),Object(r.b)("h2",{id:"caveats"},"Caveats"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Don't expect the starlark debug experience to be as nice as javascript\ndebugging, for example.  It's not as polished of a toolset.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Be prepared to make trivial changes in file of interest to force bazel to\nre-evaluate the file.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Hovering over variables generally does not work.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Conditional breakpoints don't work.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"You can only use ",Object(r.b)("inlineCode",{parentName:"p"},"bazel build")," for debugging."))),Object(r.b)("p",null,"See ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=MAXJA8Gbtxk"}),"https://www.youtube.com/watch?v=MAXJA8Gbtxk")," for a conference presentation on the debugger:"),Object(r.b)(b.a,{controls:!0,url:"https://www.youtube.com/watch?v=MAXJA8Gbtxk",mdxType:"ReactPlayer"}))}p.isMDXComponent=!0}}]);